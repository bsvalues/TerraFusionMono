
CREATE procedure IncomeCreateCopy

@input_income_id		int,
@input_sup_num			int,
@input_income_yr		numeric(4,0),
@input_new_income_id	int,
@input_new_sup_num		int,
@input_new_income_yr	numeric(4,0),
@active_valuation		varchar(1) = 'F'

as

set nocount on 

if not exists (select * 
							from income 
							with (nolock)
							where income_yr = @input_new_income_yr
							and   sup_num   = @input_new_sup_num
							and   income_id = @input_new_income_id)
begin
	
	insert into income
	(
		income_id,
		sup_num,
		income_yr,
		GBA,
		NRA,
		TAX,
		override_tax,
		override_gba,
		DC_LA,
		DC_VA,
		DC_BE,
		DC_OR,
		DC_VR,
		DC_LARate,
		DC_VARate,
		DC_LI,
		DC_VI,
		DC_GPI,
		DC_GPIVR,
		DC_GPIVI,
		DC_GPICLR,
		DC_GPICLI,
		DC_GPIRER,
		DC_GPIRE,
		DC_GPISIR,
		DC_GPISI,
		DC_EGI,
		DC_EXPOEI,
		DC_MGMTR,
		DC_MGMTI,
		DC_RRR,
		DC_RRI,
		DC_TIR,
		DC_TII,
		DC_LCR,
		DC_LCI,
		DC_EXP,
		DC_NOI,
		DC_CAPR,
		DC_CAPI,
		DC_PERS,
		DC_IND,
		DC_GPIRSF,
		DC_GPIVRSF,
		DC_GPICLRSF,
		DC_GPIRERSF,
		DC_GPISIRSF,
		DC_EGIRSF,
		DC_EGIPCTREV,
		DC_EXPOERSF,
		DC_EXPTAXRSF,
		DC_EXPMGMTRSF,
		DC_RRRSF,
		DC_EXPTIRSF,
		DC_EXPLCRSF,
		DC_EXPRSF,
		DC_EXPPCTREV,
		DC_NOIRSF,
		DC_NOIPCTREV,
		SCH_LA,
		SCH_VA,
		SCH_BE,
		SCH_OR,
		SCH_VR,
		SCH_LARate,
		SCH_VARate,
		SCH_LI,
		SCH_VI,
		SCH_GPI,
		SCH_GPIVR,
		SCH_GPIVI,
		SCH_GPICLR,
		SCH_GPICLI,
		SCH_GPIRER,
		SCH_GPIRE,
		SCH_GPISIR,
		SCH_GPISI,
		SCH_EGI,
		SCH_EXPOEI,
		SCH_MGMTR,
		SCH_MGMTI,
		SCH_RRR,
		SCH_RRI,
		SCH_TIR,
		SCH_TII,
		SCH_LCR,
		SCH_LCI,
		SCH_EXP,
		SCH_NOI,
		SCH_CAPR,
		SCH_CAPI,
		SCH_PERS,
		SCH_IND,
		SCH_GPIRSF,
		SCH_GPIVRSF,
		SCH_GPICLRSF,
		SCH_GPIRERSF,
		SCH_GPISIRSF,
		SCH_EGIRSF,
		SCH_EGIPCTREV,
		SCH_EXPOERSF,
		SCH_EXPTAXRSF,
		SCH_EXPMGMTRSF,
		SCH_RRRSF,
		SCH_EXPTIRSF,
		SCH_EXPLCRSF,
		SCH_EXPRSF,
		SCH_EXPPCTREV,
		SCH_NOIRSF,
		SCH_NOIPCTREV,
		PF_LA,
		PF_VA,
		PF_BE,
		PF_OR,
		PF_VR,
		PF_LARate,
		PF_VARate,
		PF_LI,
		PF_VI,
		PF_GPI,
		PF_GPIVR,
		PF_GPIVI,
		PF_GPICLR,
		PF_GPICLI,
		PF_GPIRER,
		PF_GPIRE,
		PF_GPISIR,
		PF_GPISI,
		PF_EGI,
		PF_EXPOEI,
		PF_MGMTR,
		PF_MGMTI,
		PF_RRR,
		PF_RRI,
		PF_TIR,
		PF_TII,
		PF_LCR,
		PF_LCI,
		PF_EXP,
		PF_NOI,
		PF_CAPR,
		PF_CAPI,
		PF_PERS,
		PF_IND,
		PF_GPIRSF,
		PF_GPIVRSF,
		PF_GPICLRSF,
		PF_GPIRERSF,
		PF_GPISIRSF,
		PF_EGIRSF,
		PF_EGIPCTREV,
		PF_EXPOERSF,
		PF_EXPTAXRSF,
		PF_EXPMGMTRSF,
		PF_RRRSF,
		PF_EXPTIRSF,
		PF_EXPLCRSF,
		PF_EXPRSF,
		PF_EXPPCTREV,
		PF_NOIRSF,
		PF_NOIPCTREV,
		flat_value,
		econ_area,
		prop_type_cd,
		class,
		level_cd,
		yr_blt,
		stories,
		prop_name,
		comment,
		value_method,
		income_value,
		lease_company,
		lease_contact,
		lease_address,
		lease_phone,
		lease_fax,
		lease_email,
		lease_survery_dt,
		recalc_flag,
		pf_input_ocr,
		pf_input_mgmtr,
		pf_input_exp_rsf,
		pf_input_si_rsf,
		pf_input_tir,
		pf_input_rrr,
		pf_input_capr,
		pf_input_lease_rsf,
		pf_date,
		DC_TAX,
		SCH_TAX,
		PF_TAX,
		override_dc_tax,
		override_sch_tax,
		override_pf_tax,
		land_ratio,
		land_ratio_typical,
		land_rsf,
		land_size,
		land_excess_value,
		lu_rent_loss_area,
		lu_rent_sf,
		lu_rent_num_year,
		lu_rent_total,
		lu_lease_pct,
		lu_lease_total,
		lu_tfo_sf,
		lu_tfo_total,
		lu_disc_rate,
		lu_num_year,
		lu_cost,
		dc_ind_rsf,
		sch_ind_rsf,
		pf_ind_rsf,
		dc_ocr_rsf,
		sch_ocr_rsf,
		pf_ocr_rsf,
		dc_ocr_runit,
		sch_ocr_runit,
		pf_ocr_runit,
		dc_ind_runit,
		sch_ind_runit,
		pf_ind_runit,
		num_units,
		override_num_units,
		lu_override_cost,
		pf_input_VARate,
		expense_structure_cd,
		lease_type_cd,
		rent_type_cd,
		pf_input_clr,
		pf_input_rer,
		pf_input_lcr,
		include_in_pf,
		DC_other_value,
		DC_other_value_comment,
		DC_base_indicated_value,
		SCH_other_value,
		SCH_other_value_comment,
		SCH_base_indicated_value,
		PF_other_value,
		PF_other_value_comment,
		PF_base_indicated_value,
		include_in_grm_gim,
		non_income_land_imps_value,
		non_income_land_value,
		non_income_imprv_value,
		other_land_value,
		schil_grid_static,
		schil_override_schedule_values,
		schil_method_value,
		schil_personal_property_value,
		schil_other_value,
		schil_other_value_comment,
		schil_base_indicated_value,
		schil_indicated_value,
		schil_indicated_land_value,
		schil_indicated_imprv_value,
		num_designated_units,
		gba_designated_units,
		DC_indicated_imprv_value,
		SCH_indicated_imprv_value,
		PF_indicated_imprv_value
	)
	select
	@input_new_income_id,   
	@input_new_sup_num,
	@input_new_income_yr, 
	GBA,
	NRA,
	TAX,
	override_tax,
	override_gba,
	DC_LA,
	DC_VA,
	DC_BE,
	DC_OR,
	DC_VR,
	DC_LARate,
	DC_VARate,
	DC_LI,
	DC_VI,
	DC_GPI,
	DC_GPIVR,
	DC_GPIVI,
	DC_GPICLR,
	DC_GPICLI,
	DC_GPIRER,
	DC_GPIRE,
	DC_GPISIR,
	DC_GPISI,
	DC_EGI,
	DC_EXPOEI,
	DC_MGMTR,
	DC_MGMTI,
	DC_RRR,
	DC_RRI,
	DC_TIR,
	DC_TII,
	DC_LCR,
	DC_LCI,
	DC_EXP,
	DC_NOI,
	DC_CAPR,
	DC_CAPI,
	DC_PERS,
	DC_IND,
	DC_GPIRSF,
	DC_GPIVRSF,
	DC_GPICLRSF,
	DC_GPIRERSF,
	DC_GPISIRSF,
	DC_EGIRSF,
	DC_EGIPCTREV,
	DC_EXPOERSF,
	DC_EXPTAXRSF,
	DC_EXPMGMTRSF,
	DC_RRRSF,
	DC_EXPTIRSF,
	DC_EXPLCRSF,
	DC_EXPRSF,
	DC_EXPPCTREV,
	DC_NOIRSF,
	DC_NOIPCTREV,
	SCH_LA,
	SCH_VA,
	SCH_BE,
	SCH_OR,
	SCH_VR,
	SCH_LARate,
	SCH_VARate,
	SCH_LI,
	SCH_VI,
	SCH_GPI,
	SCH_GPIVR,
	SCH_GPIVI,
	SCH_GPICLR,
	SCH_GPICLI,
	SCH_GPIRER,
	SCH_GPIRE,
	SCH_GPISIR,
	SCH_GPISI,
	SCH_EGI,
	SCH_EXPOEI,
	SCH_MGMTR,
	SCH_MGMTI,
	SCH_RRR,
	SCH_RRI,
	SCH_TIR,
	SCH_TII,
	SCH_LCR,
	SCH_LCI,
	SCH_EXP,
	SCH_NOI,
	SCH_CAPR,
	SCH_CAPI,
	SCH_PERS,
	SCH_IND,
	SCH_GPIRSF,
	SCH_GPIVRSF,
	SCH_GPICLRSF,
	SCH_GPIRERSF,
	SCH_GPISIRSF,
	SCH_EGIRSF,
	SCH_EGIPCTREV,
	SCH_EXPOERSF,
	SCH_EXPTAXRSF,
	SCH_EXPMGMTRSF,
	SCH_RRRSF,
	SCH_EXPTIRSF,
	SCH_EXPLCRSF,
	SCH_EXPRSF,
	SCH_EXPPCTREV,
	SCH_NOIRSF,
	SCH_NOIPCTREV,
	PF_LA,
	PF_VA,
	PF_BE,
	PF_OR,
	PF_VR,
	PF_LARate,
	PF_VARate,
	PF_LI,
	PF_VI,
	PF_GPI,
	PF_GPIVR,
	PF_GPIVI,
	PF_GPICLR,
	PF_GPICLI,
	PF_GPIRER,
	PF_GPIRE,
	PF_GPISIR,
	PF_GPISI,
	PF_EGI,
	PF_EXPOEI,
	PF_MGMTR,
	PF_MGMTI,
	PF_RRR,
	PF_RRI,
	PF_TIR,
	PF_TII,
	PF_LCR,
	PF_LCI,
	PF_EXP,
	PF_NOI,
	PF_CAPR,
	PF_CAPI,
	PF_PERS,
	PF_IND,
	PF_GPIRSF,
	PF_GPIVRSF,
	PF_GPICLRSF,
	PF_GPIRERSF,
	PF_GPISIRSF,
	PF_EGIRSF,
	PF_EGIPCTREV,
	PF_EXPOERSF,
	PF_EXPTAXRSF,
	PF_EXPMGMTRSF,
	PF_RRRSF,
	PF_EXPTIRSF,
	PF_EXPLCRSF,
	PF_EXPRSF,
	PF_EXPPCTREV,
	PF_NOIRSF,
	PF_NOIPCTREV,
	flat_value,
	econ_area,
	prop_type_cd,
	class,
	level_cd,
	yr_blt,
	stories,
	prop_name,
	comment,
	value_method,
	income_value,
	lease_company,
	lease_contact,
	lease_address,
	lease_phone,
	lease_fax,
	lease_email,
	lease_survery_dt,
	recalc_flag,
	pf_input_ocr,
	pf_input_mgmtr,
	pf_input_exp_rsf,
	pf_input_si_rsf,
	pf_input_tir,
	pf_input_rrr,
	pf_input_capr,
	pf_input_lease_rsf,
	pf_date,
	DC_TAX,
	SCH_TAX,
	PF_TAX,
	override_dc_tax,
	override_sch_tax,
	override_pf_tax,
	land_ratio,
	land_ratio_typical,
	land_rsf,
	land_size,
	land_excess_value,
	lu_rent_loss_area,
	lu_rent_sf,
	lu_rent_num_year,
	lu_rent_total,
	lu_lease_pct,
	lu_lease_total,
	lu_tfo_sf,
	lu_tfo_total,
	lu_disc_rate,
	lu_num_year,
	lu_cost,
	dc_ind_rsf,
	sch_ind_rsf,
	pf_ind_rsf,
	dc_ocr_rsf,
	sch_ocr_rsf,
	pf_ocr_rsf,
	dc_ocr_runit,
	sch_ocr_runit,
	pf_ocr_runit,
	dc_ind_runit,
	sch_ind_runit,
	pf_ind_runit,
	num_units,
	override_num_units,
	lu_override_cost,
	pf_input_VARate,
	expense_structure_cd,
	lease_type_cd,
	rent_type_cd,
	pf_input_clr,
	pf_input_rer,
	pf_input_lcr,
	include_in_pf,
	DC_other_value,
	DC_other_value_comment,
	DC_base_indicated_value,
	SCH_other_value,
	SCH_other_value_comment,
	SCH_base_indicated_value,
	PF_other_value,
	PF_other_value_comment,
	PF_base_indicated_value,
	include_in_grm_gim,
	non_income_land_imps_value,
	non_income_land_value,
	non_income_imprv_value,
	other_land_value,
	schil_grid_static,
	schil_override_schedule_values,
	schil_method_value,
	schil_personal_property_value,
	schil_other_value,
	schil_other_value_comment,
	schil_base_indicated_value,
	schil_indicated_value,
	schil_indicated_land_value,
	schil_indicated_imprv_value,
	num_designated_units,
	gba_designated_units,
	DC_indicated_imprv_value,
	SCH_indicated_imprv_value,
	PF_indicated_imprv_value
		
	from income
	where income_id = @input_income_id
	and   sup_num   = @input_sup_num
	and   income_yr = @input_income_yr    

	insert income_prop_assoc
	(
		income_id,   
		prop_id,
		sup_num,
		prop_val_yr,
		income_pct,
		income_value,
		active_valuation  
	)
	select 
		@input_new_income_id,   
		prop_id,
		@input_new_sup_num,
		@input_new_income_yr, 
		income_pct,
		income_value,
		@active_valuation
	from income_prop_assoc
	where prop_val_yr = @input_income_yr
	and sup_num = @input_sup_num
	and income_id = @input_income_id
	

	-- income_grm_gim	
	insert dbo.income_grm_gim with(rowlock) 
	(
		income_yr,
		sup_num,
		income_id,
		sch_pgi_annual,
		sch_pgi_monthly,
		sch_gim,
		sch_grm,
		sch_indicated_value_gim,
		sch_indicated_value_grm,
		sch_personal_property_value,
		sch_other_value,
		sch_base_indicated_value,
		sch_indicated_value,
		pf_pgi_annual,
		pf_pgi_monthly,
		pf_gim,
		pf_grm,
		pf_indicated_value_gim,
		pf_indicated_value_grm,
		pf_personal_property_value,
		pf_other_value,
		pf_base_indicated_value,
		pf_indicated_value,
		dc_pgi_annual,
		dc_pgi_monthly,
		dc_gim,
		dc_grm,
		dc_indicated_value_gim,
		dc_indicated_value_grm,
		dc_personal_property_value,
		dc_other_value,
		dc_base_indicated_value,
		dc_indicated_value
	)
	select
		@input_new_income_yr, 
		@input_new_sup_num,
		@input_new_income_id,
		sch_pgi_annual,
		sch_pgi_monthly,
		sch_gim,
		sch_grm,
		sch_indicated_value_gim,
		sch_indicated_value_grm,
		sch_personal_property_value,
		sch_other_value,
		sch_base_indicated_value,
		sch_indicated_value,
		pf_pgi_annual,
		pf_pgi_monthly,
		pf_gim,
		pf_grm,
		pf_indicated_value_gim,
		pf_indicated_value_grm,
		pf_personal_property_value,
		pf_other_value,
		pf_base_indicated_value,
		pf_indicated_value,
		dc_pgi_annual,
		dc_pgi_monthly,
		dc_gim,
		dc_grm,
		dc_indicated_value_gim,
		dc_indicated_value_grm,
		dc_personal_property_value,
		dc_other_value,
		dc_base_indicated_value,
		dc_indicated_value
	from dbo.income_grm_gim as igg
	where
		igg.income_yr = @input_income_yr and
		igg.sup_num = @input_sup_num and
		igg.income_id = @input_income_id

	-- income_imprv_assoc
	insert dbo.income_imprv_assoc with (rowlock) 
	(
		income_yr,
		sup_num,
		income_id,
		prop_id,
		imprv_id,
		included,
		[value]
	)
	select
		@input_new_income_yr,
		@input_new_sup_num,
		@input_new_income_id,
		prop_id,
		imprv_id,
		included,
		[value]
	from dbo.income_imprv_assoc as iia
	where
		iia.income_yr = @input_income_yr and
		iia.sup_num = @input_sup_num and
		iia.income_id = @input_income_id
		
	-- income_improvement_level_detail
	set identity_insert income_improvement_level_detail on
	
	insert dbo.income_improvement_level_detail with (rowlock) 
	(
		income_yr,
		sup_num,
		income_id,
		seq_num,
		prop_id,
		imprv_id,
		imprv_det_id,
		included,
		[override],
		copied,
		hood_cd,
		imprv_det_type_cd,
		imprv_det_meth_cd,
		floor_number,
		floor_number_override,
		primary_use_cd,
		lease_class,
		effective_year_built,
		gross_building_area,
		gross_building_area_override,
		load_factor,
		load_factor_override,
		net_rentable_area,
		net_rentable_area_override,
		daily_rent_rate,
		monthly_rent_rate,
		yearly_rent_rate,
		rent_rate_override,
		occupancy_pct,
		occupancy_pct_override,
		collection_loss,
		collection_loss_override,
		reimbursed_expenses,
		reimbursed_expenses_override,
		secondary_income,
		secondary_income_override,
		gross_potential_income,
		effective_gross_income,
		expense_ratio,
		expense_ratio_override,
		expense_per_sqft,
		expense_per_sqft_override,
		expense_overall,
		expense_overall_override,
		cap_rate,
		cap_rate_override,
		tax_rate,
		tax_rate_override,
		overall_rate,
		net_operating_income,
		value,
		imprv_desc,
		economic_area,
		economic_area_override,
		unit_count,
		unit_mix_code,
		unit_size,
		use_unit_count
	)
	select @input_new_income_yr,
		@input_new_sup_num,
		@input_new_income_id,
		seq_num,
		prop_id,
		imprv_id,
		imprv_det_id,
		included,
		override,
		copied,
		hood_cd,
		imprv_det_type_cd,
		imprv_det_meth_cd,
		floor_number,
		floor_number_override,
		primary_use_cd,
		lease_class,
		effective_year_built,
		gross_building_area,
		gross_building_area_override,
		load_factor,
		load_factor_override,
		net_rentable_area,
		net_rentable_area_override,
		daily_rent_rate,
		monthly_rent_rate,
		yearly_rent_rate,
		rent_rate_override,
		occupancy_pct,
		occupancy_pct_override,
		collection_loss,
		collection_loss_override,
		reimbursed_expenses,
		reimbursed_expenses_override,
		secondary_income,
		secondary_income_override,
		gross_potential_income,
		effective_gross_income,
		expense_ratio,
		expense_ratio_override,
		expense_per_sqft,
		expense_per_sqft_override,
		expense_overall,
		expense_overall_override,
		cap_rate,
		cap_rate_override,
		tax_rate,
		tax_rate_override,
		overall_rate,
		net_operating_income,
		value,
		imprv_desc,
		economic_area,
		economic_area_override,
		unit_count,
		unit_mix_code,
		unit_size,
		use_unit_count
	from dbo.income_improvement_level_detail as iild
	where
		iild.income_yr = @input_income_yr and
		iild.sup_num = @input_sup_num and
		iild.income_id = @input_income_id
		
	set identity_insert income_improvement_level_detail off
	
	-- income_land_detail_assoc
	insert dbo.income_land_detail_assoc with (rowlock) 
	(
		income_yr,
		sup_num,
		income_id,
		prop_id,
		land_seg_id,
		included,
		[value]
	)
	select
		@input_new_income_yr,
		@input_new_sup_num,
		@input_new_income_id,
		prop_id,
		land_seg_id,
		included,
		[value]
	from dbo.income_land_detail_assoc as ilda
	where
		ilda.income_yr = @input_income_yr and
		ilda.sup_num = @input_sup_num and
		ilda.income_id = @input_income_id
	
	-- income_pf_criteria_assoc
	insert dbo.income_pf_criteria_assoc with (rowlock) 
	(
		income_id,
		sup_num,
		income_yr,
		criteria_id,
		active_valuations_only,
		grm_gim_flag
	)
	select
		@input_new_income_id,
		@input_new_sup_num,
		@input_new_income_yr,
		criteria_id,
		active_valuations_only,
		grm_gim_flag
	from dbo.income_pf_criteria_assoc as ipca
	where
		ipca.income_yr = @input_income_yr and
		ipca.sup_num = @input_sup_num and
		ipca.income_id = @input_income_id
		
	-- income_pro_forma_assoc
	insert dbo.income_pro_forma_assoc with (rowlock) 
	(
		income_yr,
		sup_num,
		income_id,
		pf_income_id,
		pf_grm_gim_flag
	)
	select
		@input_new_income_yr,
		@input_new_sup_num,
		@input_new_income_id,
		pf_income_id,
		pf_grm_gim_flag
	from dbo.income_pro_forma_assoc as ipfa
	where
		ipfa.income_yr = @input_income_yr and
		ipfa.sup_num = @input_sup_num and
		ipfa.income_id = @input_income_id

end

set nocount off

GO

